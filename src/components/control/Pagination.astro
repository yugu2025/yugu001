---
import type { Page } from "astro";
import { Icon } from "astro-icon/components";
import { url } from "../../utils/url";

interface Props {
    page: Page;
    class?: string;
    style?: string;
}

const { page, style } = Astro.props;
const className = Astro.props.class ?? "";

const ADJ_DIST = 2;
const VISIBLE = ADJ_DIST * 2 + 1;
const HIDDEN = -1;

let l = page.currentPage;
let r = page.currentPage;
let count = 1;

while (l > 1 && r < page.lastPage && count + 2 <= VISIBLE) {
    l--;
    r++;
    count += 2;
}
while (l > 1 && count < VISIBLE) {
    l--;
    count++;
}
while (r < page.lastPage && count < VISIBLE) {
    r++;
    count++;
}

const pages: number[] = [];
if (l > 1) pages.push(1);
if (l === 3) pages.push(2);
if (l > 3) pages.push(HIDDEN);
for (let i = l; i <= r; i++) pages.push(i);
if (r < page.lastPage - 2) pages.push(HIDDEN);
if (r === page.lastPage - 2) pages.push(page.lastPage - 1);
if (r < page.lastPage) pages.push(page.lastPage);

const getPageUrl = (p: number) => (p === 1 ? "/" : `/${p}/`);
const prevHref = page.url.prev ? url(page.url.prev) : null;
const nextHref = page.url.next ? url(page.url.next) : null;
---

<div
    class:list={[className, "flex flex-row gap-3 justify-center"]}
    style={style}
>
    <a
        href={prevHref}
        aria-label="Previous Page"
        class:list={[
            "btn-card overflow-hidden rounded-lg text-[var(--primary)] w-11 h-11",
            { disabled: prevHref == null },
        ]}
    >
        <Icon
            name="material-symbols:chevron-left-rounded"
            class="text-[1.75rem]"
        />
    </a>
    <div
        class="bg-[var(--card-bg)] flex flex-row rounded-lg items-center text-neutral-700 dark:text-neutral-300 font-bold"
    >
        {
            pages.map((p) => {
                if (p == HIDDEN)
                    return (
                        <Icon name="material-symbols:more-horiz" class="mx-1" />
                    );
                if (p == page.currentPage)
                    return (
                        <div
                            class="h-11 w-11 rounded-lg bg-[var(--primary)] flex items-center justify-center
                    font-bold text-white dark:text-black/70"
                        >
                            {p}
                        </div>
                    );
                return (
                    <a
                        href={url(getPageUrl(p))}
                        aria-label={`Page ${p}`}
                        class="btn-card w-11 h-11 rounded-lg overflow-hidden active:scale-[0.85]"
                    >
                        {p}
                    </a>
                );
            })
        }
    </div>
    <a
        href={nextHref}
        aria-label="Next Page"
        class:list={[
            "btn-card overflow-hidden rounded-lg text-[var(--primary)] w-11 h-11",
            { disabled: nextHref == null },
        ]}
    >
        <Icon
            name="material-symbols:chevron-right-rounded"
            class="text-[1.75rem]"
        />
    </a>
</div>
